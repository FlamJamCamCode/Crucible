<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The New World Encyclopedia - Advanced Browser</title>
    
    <!-- Marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(15, 23, 42, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            color: #f8fafc;
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            background: linear-gradient(45deg, #60a5fa, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #cbd5e1;
            font-style: italic;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .description {
            color: #94a3b8;
            font-size: 1.1em;
            max-width: 800px;
            margin: 0 auto;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            min-height: 80vh;
        }

        .sidebar {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .search-container {
            margin-bottom: 25px;
        }

        #searchInput {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #475569;
            border-radius: 25px;
            outline: none;
            transition: all 0.3s ease;
            background: rgba(30, 41, 59, 0.8);
            color: #f8fafc;
            backdrop-filter: blur(10px);
        }

        #searchInput:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
        }

        #searchInput::placeholder {
            color: #64748b;
        }

        .category-tabs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 25px;
        }

        .tab {
            padding: 12px 20px;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid #475569;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #cbd5e1;
            text-align: center;
        }

        .tab:hover, .tab.active {
            background: linear-gradient(45deg, #60a5fa, #a78bfa);
            color: white;
            border-color: #60a5fa;
            transform: translateX(5px);
        }

        .entries-list {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .entry-item {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .entry-item:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: #60a5fa;
            transform: translateX(5px);
        }

        .entry-item.active {
            background: rgba(96, 165, 250, 0.2);
            border-color: #60a5fa;
        }

        .entry-title {
            color: #f8fafc;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .entry-type {
            display: inline-block;
            background: #dc2626;
            color: white;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.7em;
            margin-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .entry-type.historical { background: linear-gradient(45deg, #dc2626, #ef4444); }
        .entry-type.foundation { background: linear-gradient(45deg, #2563eb, #3b82f6); }
        .entry-type.dialectic { background: linear-gradient(45deg, #7c3aed, #8b5cf6); }
        .entry-type.technical { background: linear-gradient(45deg, #059669, #10b981); }
        .entry-type.magic { background: linear-gradient(45deg, #d97706, #f59e0b); }
        .entry-type.polymorphic { background: linear-gradient(45deg, #be185d, #ec4899); }
        .entry-type.philosophy { background: linear-gradient(45deg, #7c2d12, #ea580c); }
        .entry-type.economics { background: linear-gradient(45deg, #1e40af, #3b82f6); }
        .entry-type.other { background: linear-gradient(45deg, #6b7280, #9ca3af); }

        .entry-description {
            color: #cbd5e1;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .viewer {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 80vh;
        }

        .viewer-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .viewer-title {
            color: #f8fafc;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .viewer-meta {
            color: #94a3b8;
            font-size: 1.1em;
        }

        .viewer-content {
            color: #e2e8f0;
            line-height: 1.8;
            font-size: 1.1em;
        }

        .viewer-content h1, .viewer-content h2, .viewer-content h3, .viewer-content h4, .viewer-content h5, .viewer-content h6 {
            color: #f8fafc;
            margin: 25px 0 15px 0;
            font-weight: bold;
        }

        .viewer-content h1 { font-size: 2em; }
        .viewer-content h2 { font-size: 1.7em; }
        .viewer-content h3 { font-size: 1.4em; }
        .viewer-content h4 { font-size: 1.2em; }

        .viewer-content p {
            margin-bottom: 15px;
        }

        .viewer-content ul, .viewer-content ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        .viewer-content li {
            margin-bottom: 8px;
        }

        .viewer-content blockquote {
            border-left: 4px solid #60a5fa;
            padding: 15px 20px;
            margin: 20px 0;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 0 10px 10px 0;
            font-style: italic;
        }

        .viewer-content code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #fbbf24;
        }

        .viewer-content pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
        }

        .viewer-content pre code {
            background: none;
            padding: 0;
            color: #e2e8f0;
        }

        .viewer-content a {
            color: #60a5fa;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .viewer-content a:hover {
            border-bottom-color: #60a5fa;
        }

        .viewer-content strong {
            color: #f8fafc;
            font-weight: bold;
        }

        .viewer-content em {
            color: #cbd5e1;
            font-style: italic;
        }

        .loading {
            text-align: center;
            color: #94a3b8;
            font-size: 1.2em;
            padding: 40px;
        }

        .error {
            text-align: center;
            color: #ef4444;
            font-size: 1.2em;
            padding: 40px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .stats {
            margin-top: 20px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 10px;
            color: #cbd5e1;
            font-size: 0.9em;
        }

        .highlight {
            background: linear-gradient(45deg, #fde68a, #fbbf24);
            color: #0f172a;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .sidebar {
                position: static;
                height: auto;
            }
            
            .entries-list {
                max-height: 40vh;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .viewer {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>The New World Encyclopedia</h1>
            <p class="subtitle">Advanced Browser with Integrated Markdown Rendering</p>
            <p class="description">Explore the transformation from predatory systems to will-manifestation infrastructure through polymorphic crucibles, trust networks, and magical interfaces.</p>
        </header>

        <div class="main-layout">
            <div class="sidebar">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search entries...">
                </div>

                <div class="category-tabs">
                    <div class="tab active" data-category="all">All Entries</div>
                    <div class="tab" data-category="foundation">Foundations</div>
                    <div class="tab" data-category="historical">Historical</div>
                    <div class="tab" data-category="philosophy">Philosophy</div>
                    <div class="tab" data-category="magic">Magic</div>
                    <div class="tab" data-category="polymorphic">Polymorphic</div>
                    <div class="tab" data-category="technical">Technical</div>
                    <div class="tab" data-category="economics">Economics</div>
                    <div class="tab" data-category="dialectic">Dialectic</div>
                </div>

                <div class="entries-list" id="entriesList">
                    <!-- Entries will be populated by JavaScript -->
                </div>

                <div class="stats" id="stats">
                    <!-- Statistics will be populated by JavaScript -->
                </div>
            </div>

            <div class="viewer">
                <div class="viewer-header">
                    <div class="viewer-title" id="viewerTitle">Select an entry to view</div>
                    <div class="viewer-meta" id="viewerMeta"></div>
                </div>
                <div class="viewer-content" id="viewerContent">
                    <p style="text-align: center; color: #94a3b8; font-size: 1.2em; margin-top: 50px;">
                        Choose an entry from the sidebar to begin reading
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Comprehensive Encyclopedia entries data
        const encyclopediaEntries = [
            // Historical Entries
            {
                title: "New World Genesis",
                type: "historical",
                category: "Historical Overview",
                description: "The pivotal period when three distinct bootstrap scenarios emerged as pathways for establishing Polymorphic Crucible-based governance systems.",
                keywords: ["bootstrap", "terraforming", "neo-colonialism", "constitutional fork", "polymorphic crucible"],
                path: "historical-entries/new-world-genesis.md"
            },
            {
                title: "The Terraformer Bootstrap",
                type: "historical",
                category: "Private Sovereignty Initiative",
                description: "The first bootstrap scenario involving high-leverage land acquisition in anarchic territories to establish Crucible-based governance through private means.",
                keywords: ["high leverage", "land acquisition", "private military", "triad implementation", "anarchic territories"],
                path: "historical-entries/terraformer-bootstrap.md"
            },
            {
                title: "The Neo-Colonial Alliance",
                type: "historical",
                category: "International Intervention Initiative",
                description: "Coalition of nations establishing Triad-based governance in regions with suffering populations, challenging traditional sovereignty concepts.",
                keywords: ["alliance", "neo-colonialism", "humanitarian intervention", "triad bootstrap", "sovereignty rights"],
                path: "historical-entries/neo-colonial-alliance.md"
            },
            {
                title: "The Great Fork",
                type: "historical",
                category: "Constitutional Division Initiative",
                description: "Peaceful constitutional division within existing nation-states to establish parallel Polymorphic Crucible governance systems.",
                keywords: ["semi-revolution", "constitutional fork", "peaceful transition", "fractal pyramid", "empty sovereign"],
                path: "historical-entries/great-fork.md"
            },

            // Core Foundation Documents
            {
                title: "Executive Summary & Vision",
                type: "foundation",
                category: "Core Vision",
                description: "Comprehensive overview of the New World vision and foundational principles. The world as will manifestation engine.",
                keywords: ["vision", "executive summary", "overview", "will manifestation", "cosmic truth"],
                path: "foundations/1 exec_summary_vision.md"
            },
            {
                title: "Foundational Mechanisms",
                type: "foundation",
                category: "Core Systems",
                description: "Basic mechanisms underlying the New World governance and organizational systems.",
                keywords: ["mechanisms", "foundation", "systems", "core architecture"],
                path: "foundations/2 foundational_mechanisms.md"
            },
            {
                title: "Technical Architecture",
                type: "technical",
                category: "Implementation",
                description: "Technical framework for implementing New World systems and infrastructure.",
                keywords: ["technical", "architecture", "implementation", "infrastructure"],
                path: "foundations/3 technical_architecture.md"
            },
            {
                title: "Blob Classes Discovery",
                type: "technical",
                category: "AI Systems",
                description: "Neural learning of patterns too complex for categorization through blob class discovery.",
                keywords: ["blob classes", "neural learning", "pattern discovery", "categorization"],
                path: "foundations/4 blob_classes_discovery.md"
            },
            {
                title: "Language Evolution System",
                type: "technical",
                category: "Communication",
                description: "System for evolving and managing language within New World contexts through AI-discovered patterns.",
                keywords: ["language", "evolution", "communication", "neologism", "semantic"],
                path: "foundations/5 language_evolution_system.md"
            },

            // Philosophy and Will Systems
            {
                title: "Will Manifestation Philosophy",
                type: "philosophy",
                category: "Core Philosophy",
                description: "Philosophical foundations of will-based authority and manifestation principles.",
                keywords: ["will", "manifestation", "philosophy", "authority", "intention"],
                path: "foundations/15 will_manifestation_philosophy.md"
            },
            {
                title: "Daemonic Architecture",
                type: "philosophy",
                category: "Personal Systems",
                description: "Architecture for personal daemon systems and Aiddaemon interfaces.",
                keywords: ["daemon", "aiddaemon", "personal", "architecture", "interface"],
                path: "foundations/16 daemonic_architecture.md"
            },
            {
                title: "Will Coalescence & Meta-Utility",
                type: "philosophy",
                category: "Collective Systems",
                description: "Philosophical foundations of will-based authority and meta-utility frameworks for collective action.",
                keywords: ["will", "coalescence", "meta-utility", "authority", "collective"],
                path: "foundations/12 will_coalescence_meta_utility.md"
            },

            // Magic and Polymorphic Systems
            {
                title: "Magic is Right",
                type: "magic",
                category: "Magical Philosophy",
                description: "The fundamental principle that magic and power should be kept secret to prevent chaos and maintain order.",
                keywords: ["magic", "power", "secrecy", "lumen", "order"],
                path: "foundations/66. magic-is-right.md"
            },
            {
                title: "Magical Archeofuturism",
                type: "magic",
                category: "Magical Vision",
                description: "The vision of a world where technology becomes magical, aesthetic, and empowering rather than opaque and alienating.",
                keywords: ["magic", "archeofuturism", "aesthetics", "technology", "empowerment"],
                path: "foundations/67. Magical Archeofuturism.md"
            },
            {
                title: "Polymorphism and Layers of Meaning",
                type: "polymorphic",
                category: "Polymorphic Systems",
                description: "The crucible of empowerment without power sharing through polymorphic semantics and natural selection.",
                keywords: ["polymorphism", "meaning", "crucible", "empowerment", "natural selection"],
                path: "foundations/60. Polymorphism and Layers of Meaning.md"
            },
            {
                title: "Magic Seed",
                type: "polymorphic",
                category: "Language Systems",
                description: "Polymorphic semantics made clear through distributed word-based systems and semantic compression.",
                keywords: ["magic", "seed", "polymorphic", "semantics", "language", "distributed"],
                path: "foundations/61. Magic Seed.md"
            },
            {
                title: "Spell Casting",
                type: "magic",
                category: "Magical Interface",
                description: "The magical interface of deep semantic communication through spell-casting metaphors.",
                keywords: ["spell", "casting", "magic", "interface", "semantic", "communication"],
                path: "foundations/62. Spell Casting.md"
            },

            // Economic Systems
            {
                title: "Natural Selection System (NSS)",
                type: "economics",
                category: "Economic Framework",
                description: "Economic system based on natural selection principles and performance-based ownership.",
                keywords: ["nss", "natural selection", "economics", "performance", "ownership"],
                path: "foundations/24 nss.md"
            },
            {
                title: "Capital Illusion Dissolution",
                type: "economics",
                category: "Economic Critique",
                description: "Analysis of how capital systems create illusions that prevent true value creation and distribution.",
                keywords: ["capital", "illusion", "dissolution", "value", "economics"],
                path: "foundations/24a capital-illusion-dissolution.md"
            },
            {
                title: "Employment",
                type: "economics",
                category: "Labor Systems",
                description: "Reimagining employment through will-based task systems and natural selection.",
                keywords: ["employment", "labor", "tasks", "will-based", "natural selection"],
                path: "foundations/24b employment.md"
            },
            {
                title: "Markets Value Discovery",
                type: "economics",
                category: "Market Systems",
                description: "Systems for discovering true value through markets rather than imposed pricing.",
                keywords: ["markets", "value", "discovery", "pricing", "subjective"],
                path: "foundations/13 markets_value_discovery.md"
            },

            // Governance and Sovereignty
            {
                title: "Crucible Sovereignty System",
                type: "foundation",
                category: "Governance",
                description: "Detailed exposition of the Crucible system for sovereignty and governance structures.",
                keywords: ["crucible", "sovereignty", "governance", "voluntary", "marketplace"],
                path: "foundations/17 crucible_sovereignty_system.md"
            },
            {
                title: "The Sovereign Crucible and Might Is Right Alliance",
                type: "foundation",
                category: "Governance Framework",
                description: "A framework for will-based civilizations through sovereign crucibles and might-right alliances.",
                keywords: ["sovereign", "crucible", "might", "right", "alliance", "civilization"],
                path: "foundations/27. The Sovereign Crucible and the Might Is Right Alliance -- A Framework for Will-Based Civilizations.md"
            },
            {
                title: "Metagame of World Dynamics",
                type: "foundation",
                category: "Strategic Framework",
                description: "Strategic framework for understanding and navigating global power dynamics.",
                keywords: ["metagame", "world dynamics", "strategy", "power", "global"],
                path: "foundations/28 Metagame of World Dynamics.md"
            },

            // Technical Infrastructure
            {
                title: "Computational Utility Networks",
                type: "technical",
                category: "Infrastructure",
                description: "Technical framework for computational infrastructure and utility networks.",
                keywords: ["computational", "utility", "networks", "infrastructure", "technical"],
                path: "foundations/8 computational_utility_networks.md"
            },
            {
                title: "AR Phase Engine Specifications",
                type: "technical",
                category: "Augmented Reality",
                description: "Technical specifications for augmented reality phase engine systems enabling will manifestation.",
                keywords: ["ar", "augmented reality", "phase engine", "specifications", "will manifestation"],
                path: "foundations/21 ar_phase_engine_specs.md"
            },
            {
                title: "Discovery OS",
                type: "technical",
                category: "Operating Systems",
                description: "Systems that build themselves by discovering actual capabilities rather than assuming them.",
                keywords: ["discovery", "os", "operating system", "capabilities", "self-building"],
                path: "foundations/25 discovery-os-expanded-into-broader-picture.md"
            },

            // Dialectic Analysis
            {
                title: "Exhaustive Dialectical Analysis",
                type: "dialectic",
                category: "Philosophical Analysis",
                description: "Comprehensive dialectical examination of New World principles and contradictions.",
                keywords: ["dialectical", "analysis", "philosophy", "contradictions", "principles"],
                path: "dialectic-oracleness/exhaustive-dialectical-analysis.md"
            },
            {
                title: "Dialectical Synthesis",
                type: "dialectic",
                category: "Philosophical Synthesis",
                description: "Synthesis of dialectical tensions and resolutions within New World frameworks.",
                keywords: ["dialectical", "synthesis", "resolution", "tensions", "frameworks"],
                path: "dialectic-oracleness/dialectical-synthesis.md"
            },

            // Additional Foundation Documents
            {
                title: "System Integration Synthesis",
                type: "foundation",
                category: "Integration",
                description: "Comprehensive synthesis of how various New World systems integrate and function together.",
                keywords: ["integration", "synthesis", "systems", "function", "coordination"],
                path: "foundations/22 system_integration_synthesis.md"
            },
            {
                title: "Civilizational Emergence",
                type: "foundation",
                category: "Civilization Theory",
                description: "Framework for understanding how new civilizations emerge and develop through natural selection.",
                keywords: ["civilization", "emergence", "development", "natural selection", "evolution"],
                path: "foundations/14 civilizational_emergence.md"
            },
            {
                title: "Living in New World",
                type: "foundation",
                category: "Practical Life",
                description: "Practical guide to life and organization within New World systems.",
                keywords: ["living", "practical", "daily life", "organization", "guidance"],
                path: "foundations/35. living-in-new-world.md"
            },
            {
                title: "Trust Network Dynamics",
                type: "foundation",
                category: "Social Systems",
                description: "The primary information substrate enabling collective intelligence and will-coalescence.",
                keywords: ["trust", "networks", "dynamics", "collective intelligence", "will-coalescence"],
                path: "foundations/20 trust_network_dynamics.md"
            },
            {
                title: "Neologistic Reality Cutting",
                type: "philosophy",
                category: "Language Philosophy",
                description: "How language cuts reality at its joints through AI-discovered patterns and neologism generation.",
                keywords: ["neologistic", "reality", "cutting", "language", "patterns"],
                path: "foundations/30. neologistic-reality-cutting.md"
            },
            {
                title: "Aiddaemonic Semantic Bridging",
                type: "technical",
                category: "AI Interface",
                description: "Semantic bridging systems that enable deep communication between humans and AI systems.",
                keywords: ["aiddaemonic", "semantic", "bridging", "ai", "interface", "communication"],
                path: "foundations/31. aiddaemonic-semantic-bridging.md"
            }
        ];

        let currentFilter = 'all';
        let filteredEntries = [...encyclopediaEntries];
        let currentEntry = null;

        // DOM elements
        const searchInput = document.getElementById('searchInput');
        const entriesList = document.getElementById('entriesList');
        const tabs = document.querySelectorAll('.tab');
        const statsContainer = document.getElementById('stats');
        const viewerTitle = document.getElementById('viewerTitle');
        const viewerMeta = document.getElementById('viewerMeta');
        const viewerContent = document.getElementById('viewerContent');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderEntries();
            updateStats();
            
            // Search functionality
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                filterEntries(searchTerm, currentFilter);
            });
            
            // Tab functionality
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.category;
                    const searchTerm = searchInput.value.toLowerCase();
                    filterEntries(searchTerm, currentFilter);
                });
            });
        });

        function filterEntries(searchTerm, category) {
            filteredEntries = encyclopediaEntries.filter(entry => {
                const matchesSearch = searchTerm === '' || 
                    entry.title.toLowerCase().includes(searchTerm) ||
                    entry.description.toLowerCase().includes(searchTerm) ||
                    entry.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm));
                
                const matchesCategory = category === 'all' || entry.type === category;
                
                return matchesSearch && matchesCategory;
            });
            
            renderEntries();
            updateStats();
        }

        function renderEntries() {
            entriesList.innerHTML = '';
            
            if (filteredEntries.length === 0) {
                entriesList.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">No entries found matching your search criteria.</div>';
                return;
            }
            
            filteredEntries.forEach(entry => {
                const entryItem = document.createElement('div');
                entryItem.className = 'entry-item';
                
                const highlightedTitle = highlightSearchTerm(entry.title, searchInput.value);
                const highlightedDescription = highlightSearchTerm(entry.description, searchInput.value);
                
                entryItem.innerHTML = `
                    <div class="entry-type ${entry.type}">${entry.category}</div>
                    <div class="entry-title">${highlightedTitle}</div>
                    <div class="entry-description">${highlightedDescription}</div>
                `;
                
                entryItem.addEventListener('click', () => {
                    // Remove active class from all items
                    document.querySelectorAll('.entry-item').forEach(item => item.classList.remove('active'));
                    // Add active class to clicked item
                    entryItem.classList.add('active');
                    // Load the entry
                    loadEntry(entry);
                });
                
                entriesList.appendChild(entryItem);
            });
        }

        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        async function loadEntry(entry) {
            currentEntry = entry;
            viewerTitle.textContent = entry.title;
            viewerMeta.textContent = `${entry.category} • ${entry.type.toUpperCase()}`;
            viewerContent.innerHTML = '<div class="loading">Loading content...</div>';

            try {
                const response = await fetch(entry.path);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const markdown = await response.text();
                const html = marked.parse(markdown);
                viewerContent.innerHTML = html;
                
                // Highlight code blocks
                if (typeof Prism !== 'undefined') {
                    Prism.highlightAll();
                }
                
            } catch (error) {
                console.error('Error loading entry:', error);
                viewerContent.innerHTML = `
                    <div class="error">
                        <h3>Error Loading Content</h3>
                        <p>Could not load: ${entry.path}</p>
                        <p>Error: ${error.message}</p>
                        <p>Make sure you're running this from a local server (e.g., <code>python -m http.server</code>)</p>
                    </div>
                `;
            }
        }

        function updateStats() {
            const totalEntries = encyclopediaEntries.length;
            const displayedEntries = filteredEntries.length;
            const categories = [...new Set(encyclopediaEntries.map(entry => entry.type))];
            
            const categoryCounts = categories.map(category => {
                const count = encyclopediaEntries.filter(entry => entry.type === category).length;
                return `${category.charAt(0).toUpperCase() + category.slice(1)}: ${count}`;
            }).join(' | ');
            
            statsContainer.innerHTML = `
                <div><strong>Total Entries:</strong> ${totalEntries}</div>
                <div><strong>Displayed:</strong> ${displayedEntries}</div>
                <div style="margin-top: 10px; font-size: 0.8em;">
                    ${categoryCounts}
                </div>
            `;
        }
    </script>
</body>
</html>
